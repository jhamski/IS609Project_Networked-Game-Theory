---
title: "IS609 - Networked Game Theory - Final Project"
author: "J. Hamski, S. Hong, H. Berk"
date: "April 9, 2016"
output: html_document
---

```{r, message=FALSE, warning=FALSE}
library(igraph)
library(ggplot2)
library(knitr)
```

Iterated Prisoner's Dilemma on a Graph.

In the classic two person Prisoner's Dilemma . 

```{r}
nodes <- 15
degree <- 2
g.1 <- degree.sequence.game(rep(degree, nodes), method =  "vl")

#randomply select strategy
# 1 = defect, 2 = cooperate
V(g.1)$strategy <- sample(c(1,2), size = length(V(g.1)), replace = T)

V(g.1)[strategy == 1]$color <- 'red' # defect
V(g.1)[strategy == 2]$color <- 'blue' # cooperate
```

```{r}
plot(g.1)
```


Need to re-write this - it doesn't take into account the player's strategy, only the opponents!
```{r}
network.evaluation <- function(g){
  network.results <- NULL
  
  for(i in 1:nodes){
    
    opponents <- neighbors(g, i, mode="all")
    opponent.results <- NULL
    
    for(j in 1:length(opponents)){
      opponent.results <- c(opponent.results, opponents[j]$strategy)
    }
    # rbind isn't going to work when nodes have different number of edges
    network.results <- rbind(network.results, opponent.results)
  }
  return(network.results)
}
```


```{r}
game.evaluation <- function(results, nodes, g){
  row.names(results) <- 1:nodes
  results <- cbind(results, V(g)$strategy)
  
  sentence.list <- NULL
  
  for(i in 1:length(results[,1])){
    if(results[i,1] == 1){ #row defects
        opponent.sum <- sum(results[i,-1])
        if(opponent.sum == 2){sentence.list = c(sentence.list, 0)}
        if(opponent.sum == 3){sentence.list = c(sentence.list, 6)}
        if(opponent.sum == 4){sentence.list = c(sentence.list, 12)}
    }
    else{
        opponent.sum <- sum(results[i,-1])
        if(opponent.sum == 2){sentence.list = c(sentence.list, 1)}
        if(opponent.sum == 3){sentence.list = c(sentence.list, 4)}
        if(opponent.sum == 4){sentence.list = c(sentence.list, 8)}
    }
  }
  return(sentence.list)
}
```


```{r}
r <- network.evaluation(g.1)
r.list <- game.evaluation(r, nodes, g.1)
```


```{r}
results.graph <- function(results.list, nodes, g){
  for(i in 1:nodes){
    V(g)[i]$result <- results.list[i]
  }
  return(g)
}
```

```{r}
g.results <- results.graph(r.list, nodes, g.1)

results <- cbind(1:nodes, V(g.results)$result)
colnames(results) <-c("Node", "Years Sentenced")
kable(results)
```



```{r}
V(g.results)[result == 0]$color <- '#00B2E5' 
V(g.results)[result == 1]$color <- '#2696B7' 
V(g.results)[result == 4]$color <- '#4C7B89' 
V(g.results)[result == 6]$color <- '#72605B' 
V(g.results)[result == 8]$color <- '#98452D' 
V(g.results)[result == 12]$color <- '#BF2A00' 
```


```{r}
plot(g.results)
```


